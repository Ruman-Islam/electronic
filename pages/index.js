import Head from "next/head";
import Layout from "@/components/Layout";
import db from "@/utils/db";
import Product from "@/models/Product";
import Category from "@/models/Category";
import Hero from "@/components/Home/Hero";
import InfoBlock from "@/components/Home/InfoBlock";
import SpecialOffers from "@/components/Home/SpecialOffers";
import LatestProducts from "@/components/Home/LatestProducts";
import YouTubeLink from "@/components/Home/YouTubeLink";
import Categories from "@/components/Home/Categories";

const HomeScreen = ({products, categories}) => {

  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Layout title="Home">
        <Hero />
        <InfoBlock />
        <SpecialOffers products={products}/>
        <LatestProducts products={products}/>
        <YouTubeLink />
        <Categories categories={categories}/>
      </Layout>
    </>
  );
}

const getServerSideProps = async () => {
  await db.connect();
  const products = await Product.find().lean();
  const categories = await Category.find().lean();
  // const featuredProducts = await Product.find({ isFeatured: true }).lean();
  return {
    props: {
      // featuredProducts: featuredProducts.map(db.convertDocToObj),
      products: products.map(db.convertDocToObj),
      categories: categories.map(db.convertDocToObj),
    },
  };
};

export { getServerSideProps };
export default HomeScreen;